
<div align=center><a href="https://myseoulguide.site"><img src="https://user-images.githubusercontent.com/74864925/130348752-6236918a-4553-4add-a6fd-b5928e20c062.png"/></a></div>

# <div align=center>Fall IN Asia</div> 
#### <div align=center>ìš°ë¦¬ë“¤ë§Œì˜ ì‘ì€ ì—¬í–‰ ì»¤ë®¤ë‹ˆí‹°</div>

<br/>

<div align=center>
<img src="https://travis-ci.org/joemccann/dillinger.svg?branch=master"/>&nbsp;
  <img src="https://img.shields.io/github/stars/noah071610/Fall-IN-Asia?style=social"/>&nbsp;
  <img src="https://img.shields.io/github/watchers/noah071610/Fall-IN-Asia?style=social"/>&nbsp;
</div>

<br/>

<div align=center>
<img src="https://img.shields.io/badge/Photoshop-31A8FF?style=flat-square&logo=adobe-photoshop&logoColor=white"/>&nbsp;
<img src="https://img.shields.io/badge/HTML5-E34F26?style=flat-square&logo=HTML5&logoColor=white"/>&nbsp;
<img src="https://img.shields.io/badge/CSS3-1572B6?style=flat-square&logo=CSS3&logoColor=white"/>&nbsp;
<img src="https://img.shields.io/badge/JavaScript-F7DF1E?style=flat-square&logo=JavaScript&logoColor=white"/>&nbsp;
<img src="https://img.shields.io/badge/TypeScript-3178C6?style=flat-square&logo=TypeScript&logoColor=white"/>&nbsp;
<img src="https://img.shields.io/badge/React-61DAFB?style=flat-square&logo=React&logoColor=white"/>&nbsp;
<img src="https://img.shields.io/badge/Next.js-000000?style=flat-square&logo=Nextdotjs&logoColor=white"/>&nbsp;
<img src="https://img.shields.io/badge/Redux_Toolkit-764ABC?style=flat-square&logo=Redux&logoColor=white"/>&nbsp;
<img src="https://img.shields.io/badge/SWR-000000?style=flat-square&logoColor=white"/>&nbsp;
<img src="https://img.shields.io/badge/Emotion-DB7093?style=flat-square&logo=styled-components&logoColor=white"/>&nbsp;
<img src="https://img.shields.io/badge/Tailwind_CSS-38B2AC?style=flat-square&logo=TailwindCSS&logoColor=white"/>&nbsp;
<img src="https://img.shields.io/badge/Mapbox-000000?style=flat-square&logo=Mapbox&logoColor=white"/>&nbsp;
<img src="https://img.shields.io/badge/Babel-F9DC3E?style=flat-square&logo=Babel&logoColor=white"/>&nbsp;
<img src="https://img.shields.io/badge/Webpack-8DD6F9?style=flat-square&logo=Webpack&logoColor=white"/>&nbsp;
<img src="https://img.shields.io/badge/Node.js-339933?style=flat-square&logo=node-dot-js&logoColor=white"/>&nbsp;
<img src="https://img.shields.io/badge/NestJS-E0234E?style=flat-square&logo=NestJS&logoColor=white"/>&nbsp;
<img src="https://img.shields.io/badge/TypeORM-F7A600?style=flat-square&logoColor=white"/>&nbsp;
<img src="https://img.shields.io/badge/Swagger-85EA2D?style=flat-square&logo=Swagger&logoColor=white"/>&nbsp;
<img src="https://img.shields.io/badge/Amazon_AWS-232F3E?style=flat-square&logo=Amazon-AWS&logoColor=white"/>&nbsp;
<img src="https://img.shields.io/badge/Linux-FCC624?style=flat-square&logo=Linux&logoColor=white"/>&nbsp;
<img src="https://img.shields.io/badge/NGINX-009639?style=flat-square&logo=NGINX&logoColor=white"/>&nbsp;
<img src="https://img.shields.io/badge/PM2-2B037A?style=flat-square&logo=PM2&logoColor=white"/>&nbsp;
</div>

<br/>

<div align=center>
  <a href="https://github.com/noah071610" target="_blank"><img src="https://image.flaticon.com/icons/png/24/25/25657.png"/></a>&nbsp;
  <a href="https://www.instagram.com/salmonchobab" target="_blank"><img src="https://image.flaticon.com/icons/png/24/1409/1409946.png"/></a>&nbsp;
  <a href="mailto:noah071610@naver.com"><img src="https://image.flaticon.com/icons/png/24/552/552486.png"/></a>&nbsp;
  <a href="https://jshyunsoo.site/" target="_blank"><img src="https://image.flaticon.com/icons/png/24/3135/3135715.png"/></a>&nbsp;
</div>

<br/>

<div align=center>
  <a href="https://fallinasia.com"><img src="https://img.shields.io/badge/go_to_website-EFFDFF?style=for-the-badge"/>&nbsp;</a>
</div>

<br/><br/><br/><br/><br/>

## ğŸ›º Fall IN asia ì†Œê°œ
#### ìš°ë¦¬ë“¤ë§Œì˜ ì‘ì€ ì—¬í–‰ ì»¤ë®¤ë‹ˆí‹°.
<br/>

> ğŸ¤ : ê°„ë‹¨í•˜ê²Œ Fall IN asiaë¥¼ ì†Œê°œí•´ì£¼ì„¸ìš”.

ì—¬í–‰ì„ ë– ë‚˜ëŠ” ì‚¬ëŒ ì¤‘ 80% ì´ìƒì€ ì—¬í–‰ ì¤‘ ìê¸° ìƒê°ê³¼ ê²½í—˜ì„ ê³µìœ í•˜ë ¤ê³  í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì¼ë°˜

ë¸”ë¡œê·¸ì—ì„œëŠ” UI/UXì  ìš”ì†Œì™€ ê¸°ëŠ¥ ê·¸ë¦¬ê³  ì»¤ë®¤ë‹ˆí‹°ê°€ ì—¬í–‰ì¼ì§€ì— ë¶€ì í•©í•©ë‹ˆë‹¤. ì €ëŠ” ì´ëŸ°

ë‹¨ì ì— ì£¼ëª©í•´ ì•„ì‹œì•„ ë°°ë‚­ì—¬í–‰ìë“¤ì„ ìœ„í•œ ì»¤ë®¤ë‹ˆí‹° ì›¹ì‚¬ì´íŠ¸ë¥¼ ê°œë°œí–ˆìŠµë‹ˆë‹¤. ì—°ëŒ€ê¸°ë¼ëŠ”

ì•„ì´ë´í‹°í‹°ë¥¼ ë§Œë“¤ì–´ ì—¬í–‰ìë“¤ì´ ì¢€ ë” ì‰½ê³  ì´í™íŠ¸ìˆê²Œ ì—¬í–‰ì¼ì§€ë¥¼ ì‘ì„±í•˜ê³  ê³µìœ í•  ìˆ˜ ìˆë„ë¡

ìœ ë„í–ˆê³  ë‚¯ì„  í˜„ì§€ì—ì„œë„ í•œêµ­ì¸ê³¼ ì •ë³´êµë¥˜ë¥¼ í•˜ë©° íƒ€ì§€ë¥¼ í•¨ê»˜ í—¤ì³ ë‚˜ê°ˆ ìˆ˜ ìˆë„ë¡

ëª¨ë©˜íŠ¸ë¼ëŠ” í¸ë¦¬í•œ ì •ë³´êµë¥˜ í”Œë«í¼ë„ ì œê³µí•©ë‹ˆë‹¤.

<br/><br/>

## ğŸ›« Fall IN asia ê¸°ë³¸ì •ë³´
<br/>

- ì œì‘ê¸°ê°„ : 2021/6 ~ 2021/8
- ê°œë°œì : ì¥í˜„ìˆ˜ (Noah) ì™¸ 0ëª…
- ê°œë°œí¬ì§€ì…˜ : ë””ìì¸ , í”„ë¡ íŠ¸ì—”ë“œ , ë°±ì—”ë“œ , ë°°í¬
- ë°˜ì‘í˜• ì›¹ ì‚¬ì´íŠ¸

<br/><br/>

## ğŸš Fall IN asia ë¦¬ë·°
#### ë§ˆì´ ì„œìš¸ ê°€ì´ë“œì˜ ê¸°ë³¸ì ì¸ íë¦„ì— ëŒ€í•´ì„œ ë¦¬ë·°í•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤.
<br/>

### 1. ë©”ì¸í˜ì´ì§€ëŠ” ì¸ê¸° ì—¬í–‰ì§€ì™€ ì—°ëŒ€ê¸°, ëª¨ë©˜íŠ¸ ë“±ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ìˆìŠµë‹ˆë‹¤.
- ì¢‹ì€ ë””ìì¸ì˜ ì›¹ì‚¬ì´íŠ¸ëŠ” ì‹¬ì§€ì–´ ì‹ ë¢°ì„±ê¹Œì§€ ë†’ì¸ë‹¤ëŠ” ë¶„ì„ì— ì¸ìƒê¹Šì–´, ìµœëŒ€í•œ ê¹”ë”í•œ ë””ìì¸ìœ¼ë¡œ ì´ìš©ìë¥¼ ì¡ê¸°ìœ„í•´ ë…¸ë ¥í–ˆìŠµë‹ˆë‹¤.

<br/>
<div align=center>
  
![fallinasia_main](https://user-images.githubusercontent.com/74864925/130349185-ad01e0d0-5786-4e77-86bc-6a25f974c4fe.png)
![fallinasia_news_main](https://user-images.githubusercontent.com/74864925/130349229-7ca37190-871c-4b4b-a064-efd4f041b358.png)
![fallinasia_story_main](https://user-images.githubusercontent.com/74864925/130349226-c87f34e1-a869-417a-a081-a98369fab2bf.png)
  
</div>

<br/>

### 2. ëª¨ë©˜íŠ¸í˜ì´ì§€ëŠ” êµ­ê°€ë³„ë¡œ ë‚˜ëˆ„ì–´ì ¸ìˆê³  í•„í„°ì™€ íƒ€ì…ì„ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- êµ­ê°€ë³„ ì„ íƒí˜ì´ì§€ì—ì„œ ì‰½ê²Œ êµ­ê°€ì„ íƒì´ ê°€ëŠ¥í•˜ê³  êµ­ê°€ì— ë§ëŠ” ë‰´ìŠ¤ì™€ ì—°ëŒ€ê¸°ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.

<br/>

<div align=center>

![fallinasia_country_select](https://user-images.githubusercontent.com/74864925/130349356-1e3004c1-8707-4927-a1c2-0e56a3e5ccb4.gif)
  
  </div>

<br/>

### 3. ì—°ëŒ€ê¸°í˜ì´ì§€ì—ì„œ ì‚¬ìš©ìëŠ” ìì‹ ì˜ ì—¬í–‰ì¼ì§€ë¥¼ ì‘ì„±í•˜ë©° ê³µìœ í•©ë‹ˆë‹¤.
- ìœ„ë„ì™€ê²½ë„ë¥¼ ì‚¬ìš©í•œ ì—°ëŒ€ê¸°ë§µ, ê²Œì‹œë¬¼ ëª©ì°¨ , ì´ì „&ë‹¤ìŒí˜ì´ì§€ (ì„œë²„ì—ì„œ ì‘ì„±ìì™€ ê´€ë ¨ëœ ê²Œì‹œê¸€ì„ ìš°ì„ ìœ¼ë¡œ ë³´ë‚´ì¤Œ) , ì½”ë©˜íŠ¸ê¸°ëŠ¥ ë“±ì„ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

<br/>

<div align=center>

![fallinasia_story_thumb](https://user-images.githubusercontent.com/74864925/130349410-0392ce16-795e-4880-9253-bd02a5ad9bf8.png)

![fallinasia_story_map](https://user-images.githubusercontent.com/74864925/130349412-e3a87df2-e1fd-4632-9c8d-27783eac3a20.png)

![fallinasia_story_article](https://user-images.githubusercontent.com/74864925/130349415-6e00b5d4-65d5-40ee-9f03-866004ba84ac.png)

![fallinasia_story_pagination](https://user-images.githubusercontent.com/74864925/130349419-771114a4-4db5-4291-a9bb-6a1bdaa7a48d.png)
  
  </div>

```javascript

ğŸ“story/[code]/[storyId]/index.tsx

  // aside ëª©ì°¨ êµ¬í˜„
  useEffect(() => {
    // DOMì— ì§ì ‘ ì ‘ê·¼í•´ classë¥¼ ì§€ì •í•©ë‹ˆë‹¤.
    // spanì— classë¥¼ ì¶”ê°€í•œ ì´ìœ ? : fixedí—¤ë”ë¡œ offsetì´ ìœ„ë¡œ ì˜¬ë¼ê°€ë²„ë ¤ì„œ ë¹ˆ spanê°’ì— absoluteë¥¼ ì ìš©í•´ ë§ì¶°ì£¼ì—ˆìŠµë‹ˆë‹¤.
    if (story) {
      let contentHeaders = document.querySelectorAll(".post-content > h1 , .post-content > h2");
      contentHeaders.forEach((v, i) => {
        const span = document.createElement("span");
        span.setAttribute("id", \`header_\${i + 1}\`);
        span.classList.add("anchor-offset-controller");
        v.classList.add("anchor-offset-parent");
        v.appendChild(span);
      });
    }
  }, [story]);

  ...

  
  ğŸ“PostAsideNav/index.tsx
  
  // aside ëª©ì°¨ êµ¬í˜„
  useEffect(() => {
    if (postData) {
      // ì •ê·œì‹ìœ¼ë¡œ í—¤ë”ì˜ ë¬¸ìë§Œ ê°€ì ¸ì™€ ë°°ì—´ë¡œ ë§Œë“­ë‹ˆë‹¤.
      const headers =
        postData?.content
          ?.match(/<h1([^])*?.*?<\/h1>|<h2([^])*?.*?<\/h2>/g)
          ?.join(",")
          .split(",") || [];

      // stateì— ì €ì¥í•©ë‹ˆë‹¤. ì´ ë°°ì—´ê°’ì€ ëª©ì°¨ì˜ ë°”ë¡œê°€ê¸° ê¸°ëŠ¥ì— ì‚¬ìš©ë©ë‹ˆë‹¤.
      setHdClassList(Array.from({ length: headers.length }, (v, i) => "header_" + (i + 1)));
      setHeaders(headers);
    }
  }, [postData]);

  ...

  ğŸ“stories.service.ts

  // ì´ì „,ë‹¤ìŒ í˜ì´ì§€ êµ¬í˜„
  // ì‘ì„±ìì˜ ì´ì „,ë‹¤ìŒ ê²Œì‹œê¸€ë¥¼ ìš°ì„ ì ìœ¼ë¡œ ê°€ì ¸ì˜µë‹ˆë‹¤.

  async getSidePosts(storyId: number, userId: number) {
    const prevPost = await this.StoriesRepository.findOne({
      select: ['thumbnail', 'title', 'code', 'id'],
      where: { user: userId, id: LessThan(storyId) },
    }).then((res) =>{ 
      if (!res) {
        // ë§Œì•½ ì‘ì„±ìì˜ ê²Œì‹œê¸€ì´ ë” ì´ìƒ ì—†ë‹¤ë©´ ìœ ì € ê²Œì‹œê¸€ì´ ì•„ë‹Œ ì´ì „ ë˜ëŠ” ë‹¤ìŒê²Œì‹œê¸€ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
        return this.StoriesRepository.findOne({
          select: ['thumbnail', 'title', 'code', 'id'],
          where: { id: LessThan(storyId) },
        });
      } else {
        return res;
      }
    });

  ...

  ğŸ“Comment/index.tsx

  // Comment Like ê¸°ëŠ¥
  const onClickLikeOrDisLike = useCallback(
    (value: string) => {
      if (!user) {
        toastErrorMessage("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
        return;
      }
      axios
        .patch(\`/comment/\${value}/\${comment?.id}\`)
        .then(() => {
          if (value === "like") {
            toastSuccessMessage("ëŒ“ê¸€ ì¢‹ì•„ìš”!ğŸ’“");
          } else {
            toastSuccessMessage("ëŒ“ê¸€ ì¢‹ì•„ìš” ì·¨ì†ŒğŸ’”");
          }
          // ì¢‹ì•„ìš” ë˜ëŠ” ì¢‹ì•„ìš”ì·¨ì†Œê°€ ì •ìƒì ìœ¼ë¡œ ìˆ˜í–‰ë˜ë©´ swrì„ revalidate í•´ì¤ë‹ˆë‹¤.
          revalidateComments();
          dispatch(getUserInfoAction());
        })
        .catch((error) => {
          toastErrorMessage(error);
          throw error;
        });
    },
    [user, comment]
  );

  ...

  // Commentë¥¼ í´ë¦­í•˜ë©´ subCommentFormì´ ì—´ë¦¬ê³  ë‹µê¸€ì„ ì‘ì„± í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  {onSubCommentForm && (
    <SubCommentForm revalidateComments={revalidateComments} commentId={comment?.id} />
  )}
  // ë‹µê¸€ì´ 3ê°œì´ìƒ ë„˜ì–´ê°€ì„œ ê¸¸ì–´ì§€ë©´ ìë™ìœ¼ë¡œ ë”ë³´ê¸° ë²„íŠ¼ì´ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.
  {comment?.subComments?.length > 2 && (
    <div onClick={onChangeSubCommentList} className="more-subComment">
      <button className="more-subComment-btn">
        <span className="count">{comment?.subComments?.length}</span>
        ê°œì˜ ë‹µê¸€
        <DownCircleOutlined rotate={onSubCommentList ? 180 : 0} />
      </button>
    </div>
  )}
  // ë‹µê¸€ì´ ìˆë‹¤ë©´ ë‹µê¸€ì„ ë¿Œë ¤ì¤ë‹ˆë‹¤.
  {onSubCommentList &&
    comment?.subComments?.map((v, i) => {
      return <SubComment key={i} revalidateComments={revalidateComments} subComment={v} />;
    })}
  
 ```

<br/>

### 4. ìœ ì €í˜ì´ì§€ì—ì„œ ìì‹ ì´ ì—¬í–‰í–ˆë˜ êµ­ê°€ì˜ ë£¨íŠ¸ë§µ ê·¸ë¦¬ê³  êµ­ê°€ë¦¬ìŠ¤íŠ¸ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ê²Œì‹œê¸€ & ë‹µê¸€ ì•Œë¦¼ì‹œìŠ¤í…œ , ì—¬í–‰í–ˆë˜ êµ­ê°€ë¦¬ìŠ¤íŠ¸ ë§µ ë° overview , ì‘ì„± ê²Œì‹œë¬¼ ì „ì²´ë³´ê¸°ë¥¼ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

<br/>

<div align=center>

![fallinasia_user_map](https://user-images.githubusercontent.com/74864925/130349463-abe5f706-96d0-4315-9e29-9fde7f2b5c39.gif)
  
  </div>

```javascript

ğŸ“CountryRouteMap.tsx

  const CountryRouteMap: FC<IProps> = ({ stories }) => {
    const mapRef = useRef<MapRef>(null);
    const [viewport, setViewport] = useState({
      width: "100%",
      height: 350,
      // í˜¹ì‹œ ê°’ì´ ì—†ìœ¼ë©´ ëŒ€í•œë¯¼êµ­ì˜ ì •ì¤‘ì•™ì„ ì¢Œí‘œë¡œ ì‚¼ìŠµë‹ˆë‹¤.
      latitude: stories?.[0]?.lat || 37.50529626491968,
      longitude: stories?.[0]?.lng || 126.98047832475031,
      zoom: 1,
    });

    const route = useMemo(() => {
      return {
        type: "Feature",
        properties: {},
        geometry: {
          type: "LineString",
          //story ì—”í‹°í‹°ì˜ ì¹¼ëŸ¼ì—ëŠ” ì¢Œí‘œê°€ ìˆìŠµë‹ˆë‹¤. ì´ê°’ì„ 2ì¤‘ë°°ì—´ìœ¼ë¡œ ë¿Œë ¤ì¤ë‹ˆë‹¤.
          coordinates: stories?.map((v) => [v.lng, v.lat]),
        },
      };
    }, [stories]);

    const handleViewportChange = useCallback(
      // ì¢Œí‘œê°€ ë³€í•˜ë©´ ê·¸ ê°’ì„ ì €ì¥í•©ë‹ˆë‹¤. ë„“ì´ëŠ” ê³ ì •ìœ¼ë¡œ 100%ë¥¼ ìœ ì§€í•˜ê¸°ìœ„í•´ ìŠ¤í”„ë ˆë“œì—°ì‚°ìì™€ ê°™ì´ í™œìš©í–ˆìŠµë‹ˆë‹¤.
      (newViewport) => setViewport({ ...newViewport, width: "100%" }),
      []
    );

    return (
      <ReactMapGL
        className="map-gl"
        ref={mapRef}
        {...viewport}
        mapboxApiAccessToken={process.env.NEXT_PUBLIC_MAPBOX_API_KEY}
        onViewportChange={handleViewportChange}
        mapStyle="mapbox://sprites/mapbox/basic-v8"
        asyncRender={true}
        transitionInterpolator={new FlyToInterpolator()}
      >
        <Source type="geojson" data={route as any}>
          <Layer
            id="route"
            type="line"
            source="route"
            layout={{ "line-join": "round", "line-cap": "round" }}
            paint={{ "line-color": "red", "line-width": 2 }}
          />
        </Source>
        {/* ì¢Œí‘œê°’ì— ë§ê²Œ ë§ˆì»¤ë¥¼ ë¿Œë ¤ì¤ë‹ˆë‹¤. */}
        {stories?.map((v, i) => (
          <Marker
            key={i}
            longitude={v.lng}
            latitude={v.lat}
            offsetTop={-20}
            offsetLeft={-10}
            draggable={false}
          >
            <Pin isUserInfoPage={true} story={v} size={20} />
          </Marker>
        ))}
      </ReactMapGL>
    );
  };

  export default memo(CountryRouteMap);

  ...

  ğŸ“VisitedCountryList.tsx

  const VisitedCountryList: FC<IProps> = ({ stories }) => {
    
    // ê°’ì„ ìºì‹±í•˜ê¸° ìœ„í•´ useMemoë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

    const storiesWithoutSame = useMemo(() => {

      // ë‹¤ë…€ì˜¨ êµ­ê°€ ë¦¬ìŠ¤íŠ¸ì—ì„œ ì¤‘ë³µì„ ì œê±°í•´ ë°˜í™˜í•©ë‹ˆë‹¤.
      // filterë¡œ ë°°ì—´ì„ ìˆœíšŒí•©ë‹ˆë‹¤ ì¤‘ë³µëœ ê°’(êµ­ê°€)ê°€ ë‚˜ì˜¤ë©´ findIndexì˜ ê°’ê³¼ filterì˜ i ê°’ì´ ì¼ì¹˜í•˜ì§€ ì•Šê²Œë˜ì–´ ê±¸ëŸ¬ì§‘ë‹ˆë‹¤.
      // codeëŠ” êµ­ê°€ì½”ë“œì…ë‹ˆë‹¤ (ì˜ˆ : KR JP TH)

      return stories?.filter((v, i, arr) => i === arr.findIndex((t) => v.code === t.code));
    }, [stories]);
  
    return (
      <VisitedCountryListWrapper>
        {storiesWithoutSame?.map((v, i) => (
          <li key={i}>
            <div className="image-wrapper">
              <img src={v.country.flag_src} alt="flag_image" />
            </div>
            <span>{v.country.name}</span>
          </li>
        ))}
      </VisitedCountryListWrapper>
    );
  };
  
  export default memo(VisitedCountryList);
 
 ```

<br/>

### 5. ìœ ì €í˜ì´ì§€ì—ì„œ ìê¸°ì†Œê°œ, ì•„ì´ì½˜, ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ë° íšŒì›íƒˆí‡´ ê·¸ë¦¬ê³  íŒ”ë¡œìš°ì™€ ì–¸íŒ”ë¡œìš°ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.
- ì•„ì´ì½˜ì€ cropì„ ì‚¬ìš©í•´ ì›í•˜ëŠ” ì‚¬ì´ì¦ˆë¡œ ì˜ë¼ì„œ ë³€ê²½ ê°€ëŠ¥í•˜ë©° íŒ”ë¡œìš° ê¸°ëŠ¥ì€ DBì˜ ë‹¤ëŒ€ë‹¤ ê´€ê³„ í…Œì´ë¸”ì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.

<br/>

<div align=center>

![fallinasia_user_crop](https://user-images.githubusercontent.com/74864925/130349485-b07e35c9-ff4e-4e17-96aa-2e87146681ca.gif)
  
  </div>

```javascript

ğŸ“IconCropperModal/index.tsx

  ...
  
  return (

      ...

    {upImg ? (
      {/* upImgê°€ ìˆë‹¤ë©´ í¬ë¡­ì°½ì„ ë„ì›Œì¤ë‹ˆë‹¤ ì´ë¯¸ì§€ë¥¼ ì •ì‚¬ê°í˜•í¬ê¸°ë¡œ ì˜ë¼ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. */}
      <div className="crop-image-wrapper">
        <ReactCrop
          className="crop-image"
          src={upImg as string}
          onImageLoaded={onLoad}
          crop={crop}
          onChange={(c) => setCrop(c)}
          onComplete={(c) => setCompletedCrop(c)}
        />
      </div>
    ) : (
      {/* upImgê°€ ì—†ë‹¤ë©´ ì—…ë¡œë“œì°½ì„ í‘œì‹œí•©ë‹ˆë‹¤. dragí•´ì„œ í¸ë¦¬í•˜ê²Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤. */}
      <Dragger
        showUploadList={false}
        multiple={false}
        className="dragger"
        onChange={handleChange}
      >
        <div className="dragger-inside-image">
          <img
            src="https://user-images.githubusercontent.com/74864925/124657825-f38a5500-dedd-11eb-8de9-6ed70a512f24.png"
            alt="drag"
          />
          <p>ì´ë¯¸ì§€ ë“œë˜ê·¸ ë˜ëŠ” ì„ íƒ</p>
        </div>
      </Dragger>
    )}
    {upImg && (
      {/* í¬ë¡­ì´ë¯¸ì§€ê°€ ì‹¤ì œ ì•„ì´ì½˜ì— ì–´ë–»ê²Œ í‘œì‹œë ì§€ ë¯¸ë¦¬ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. */}
      <div className="image-preview">
        <NameSpaceWrapper className="name-space-preview">
          <div className="icon">
            <canvas className="cropped-image" ref={previewCanvasRef} />
          </div>
          <div className="user-info">
            <span className="name">{user?.name}</span>
            <span className="date">2021/07/29</span>
          </div>
        </NameSpaceWrapper>
        <div className="btn-wrapper">
          <button onClick={() => setUpImg(null)}>ë‹¤ì‹œ ì„ íƒ</button>
          <button className="btn-point" onClick={onClickChangeIcon}>
            ì´ë¯¸ì§€ ì˜¬ë¦¬ê¸°
          </button>
        </div>
      </div>
    )}
  )
  
  ...

  ğŸ“UserInfoAside/index.tsx

  ...

  <h3>íŒ”ë¡œì›Œ</h3>
  {userInfo && (
    <div className="follow-wrapper">
      <div className="follow-icon-wrapper">
        {/* ìµœëŒ€ 6ëª…ì˜ íŒ”ë¡œì›Œ ì•„ì´ì½˜ì„ í‘œì‹œí•´ì¤ë‹ˆë‹¤. */}
        {userInfo?.followers.slice(0, 6).map((v, i) => (
          <img key={i} src={v.follower.icon} alt="follow-icon" />
        ))}
      </div>
      <span>
        {/* userì— follow í…Œì´ë¸”ì„ ì¡°ì¸í•´ ê°€ì ¸ì™€ ë¿Œë ¤ì¤ë‹ˆë‹¤. */}
        {userInfo.followers.length > 0
          ? \`\${userInfo?.followers[0].follower?.name}ë‹˜ ì™¸ \${
              userInfo?.followers?.length - 1
            }ëª… íŒ”ë¡œìš°.\`
          : "ì•„ì§ íŒ”ë¡œì›Œê°€ ì—†ìŠµë‹ˆë‹¤."}
      </span>
    </div>
  )}
  <h3>íŒ”ë¡œì‰</h3>
  {/* íŒ”ë¡œì›Œì™€ ê°™ì€ ë§¥ë½ìœ¼ë¡œ ì‘ì„± */}
  
  ...

  ğŸ“Follow.ts

  // @ManyToMany()ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì€ ì´ìœ ? : nestJSì—ì„œ ManyToManyê´€ë ¨ ì´ìŠˆê°€ ë§ì•„ì„œ 
  // ì•ˆì •ì„±ì„ ê³ ë ¤í•´ ì‚¬ìš©í•˜ì§€ì•Šê³  Followí…Œì´ë¸”ì— 1ëŒ€ë‹¤ê´€ê³„ë¡œ ë¬¶ì–´ì¤¬ìŠµë‹ˆë‹¤ (ê°™ì€ ê¸°ëŠ¥ì„ ìˆ˜ì‘ì—…ìœ¼ë¡œ êµ¬í˜„í•œ ëŠë‚Œ)

  @IsNotEmpty()
  @ApiProperty({
    example: 1,
    description: 'followingId (Following)',
  })
  @Column()
  followingId: number;

  @IsNotEmpty()
  @ApiProperty({
    example: 1,
    description: 'followerId (Follower)',
  })
  @Column()
  followerId: number;

  @ManyToOne(() => Users, (users) => users.followings, {
    onDelete: 'CASCADE',
    onUpdate: 'CASCADE',
  })
  @JoinColumn({ name: 'followingId' })
  following: Users;

  @ManyToOne(() => Users, (users) => users.followers, {
    onDelete: 'CASCADE',
    onUpdate: 'CASCADE',
  })
  @JoinColumn({ name: 'followerId' })
  follower: Users;

  ...

```

<br/>

### 6. ë°˜ì‘í˜•ì„ ì§€ì›í•©ë‹ˆë‹¤.
- ëª¨ë°”ì¼ì—ì„œë„ ì´ìš©ìê°€ ë¶ˆí¸í•˜ì§€ ì•Šë„ë¡ ë°˜ì‘í˜•ìœ¼ë¡œ ê°œë°œí–ˆìŠµë‹ˆë‹¤.

<br/>

<div align=center>

![fallinasia_main_mobile](https://user-images.githubusercontent.com/74864925/130349515-f4596e82-b927-4853-acdc-2b8a643958e1.gif)

![fallinasia_story_mobile](https://user-images.githubusercontent.com/74864925/130349517-ad87d49d-1b91-4c7a-baff-79eddcd21ec5.gif)
  
  </div>

<br/>

### 7. IntersectionObserver ë¥¼ ì´ìš©í•´ ìµœì ì„±ëŠ¥ì˜ infinite scrollì„ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.
- ì´ì „ í”„ë¡œì íŠ¸(Noahworld)ì—ì„œ scroll eventë¡œë§Œ ì‚¬ìš©í•´ êµ¬í˜„í–ˆì„ë•Œë³´ë‹¤ ì„±ëŠ¥ì´ í–¥ìƒë¬ìŠµë‹ˆë‹¤. ë˜ í”¼ì¹˜ëª»í•˜ê²Œ scroll eventë¥¼ ì´ìš©ì‹œ throttleì„ ì ìš©í•©ë‹ˆë‹¤.

<br/>

<div align=center>

![fallinasia_infinite](https://user-images.githubusercontent.com/74864925/130349543-a89b7c2b-a4b4-4ad8-8b09-138f62415e94.gif)
  
  </div>

```javascript

ğŸ“index.tsx

  // swrê³¼ observerë¥¼ ì´ìš©í•´ infinite ìŠ¤í¬ë¡¤ì„ êµ¬í˜„í•©ë‹ˆë‹¤.

  const { query } = useRouter();
  const [filter, setFilter] = useState("");
  const {
    data: moments,
    revalidate: revalidateMoments,
    setSize,
  } = useSWRInfinite<IMoment[]>(
    (index) => \`/moment?page=\${index + 1}&filter=\${filter}&type=\${query?.type || ""}\`,
    fetcher,
    {
      // SSRë¡œ ì„œë²„ì—ì„œ ë Œë”ëœ initial Dataë¥¼ ë„£ì–´ì¤ë‹ˆë‹¤
      initialData: initialMoments,
      ...noRevalidate,
    }
  );

  ...

  ğŸ“hooks/useOnScreen.ts

  const useOnScreen = (ref: RefObject<HTMLDivElement>) => {
    const [isIntersecting, setIntersecting] = useState(false);
  
    useEffect(() => {
      // observerë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
      const observer = new IntersectionObserver(([entry]) => setIntersecting(entry.isIntersecting));
  
      // MomentListì˜ refë¥¼ ë„£ì–´ì¤ë‹ˆë‹¤.
      if (ref?.current !== null) {
        //refëŠ” ìµœì´ˆ nullê°’ì´ê³  ë Œë”ë§ì‹œ domì„ ì¡ì•„ì˜µë‹ˆë‹¤.
        //ì´ì— ì•Œë§ê²Œ ifë¬¸ì„ ë„£ì–´ì¤¬ìŠµë‹ˆë‹¤.
        observer.observe(ref.current);
      }
      return () => {
        // ë©”ëª¨ë¦¬ ë‚­ë¹„ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ unmountì‹œ ì—°ê²°ì„ ëŠì–´ì¤ë‹ˆë‹¤.
        observer.disconnect();
      };
    }, []);
  
    return isIntersecting;
  };

  export default useOnScreen;


  ğŸ“MomentList/index.tsx

  interface IProps {
    moments: IMoment[][] | undefined;
    setSize: (f: (size: number) => number) => Promise<IMoment[][] | undefined>;
    setFilter: (filter: string) => void;
    filter: string;
    revalidateMoments: () => void;
  }

  const MomentList: FC<IProps> = ({ revalidateMoments, filter, moments, setSize, setFilter }) => {
    const [isReachingEnd, setIsReachingEnd] = useState(true);
    const ref = useRef<HTMLDivElement>(null);
    const isVisible = useOnScreen(ref);
    const isEmpty = moments?.[0]?.length === 0;

    useEffect(() => {
      if (moments) {
        // ì´ì¤‘ë°°ì—´ì˜ ë§ˆì§€ë§‰ê°’ì˜ ê¸¸ì´ê°€ 10ê°œê°€ ì•„ë‹Œì§€ í™•ì¸í•©ë‹ˆë‹¤.
        // ì„œë²„ì—ì„œ 10ê°œì”© ë°ì´í„°ë¥¼ ê°€ì§€ê³  ì˜´ìœ¼ë¡œ 10ê°œ ë¯¸ë§Œì´ë©´ ëì— ë„ë‹¬í–ˆë‹¤ê³  íŒë‹¨í•˜ê³  falseë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
        setIsReachingEnd(moments[moments.length - 1]?.length < 10);
      }
    }, [moments]);
    useEffect(() => {
      // dataê°€ ì•„ì§ ë‚¨ì•„ìˆìœ¼ë©´ size ê°’ì„ 1ì”© ì¦ê°€ì‹œì¼œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
      if (isVisible && !isReachingEnd && !isEmpty) {
        setSize((prev) => prev + 1).then(() => {});
      }
    }, [isVisible]);

    // swrê°€ ì´ì¤‘ë°°ì—´ì„ ê°€ì ¸ì˜¤ê¸° ë•Œë¬¸ì— flat ë©”ì˜ë“œë¥¼ ì‚¬ìš©í•´ì„œ 1ì°¨ì›ë°°ì—´ë¡œ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.
    const momentsData = moments ? moments?.flat() : [];

    return (
      <MomentListWrapper>
        <div className="content-wrapper">
          <div className="content-filter">
            {/* í•„í„°ë¥¼ ëˆ„ë¥´ë©´ queryì— ë„£ì–´ì ¸ ê·¸ì— ë§ëŠ” ë°ì´í„°ë¥¼ ë‹¤ì‹œ ê°€ì ¸ì˜µë‹ˆë‹¤. */}
            <button
              style={filter === "" ? { fontWeight: "bold", color: BLUE_COLOR } : {}}
              onClick={() => setFilter("")}
            >
              ìµœì‹ ìˆœ
            </button>
            
            ...

          </div>
          {/* ë°ì´í„°ë¥¼ ë¿Œë ¤ì¤ë‹ˆë‹¤. */}
          {momentsData.length > 0 ? (
            momentsData?.map((v, i) => {
              if (momentsData.length - 1 === i) {
                {/* ë§ˆì§€ë§‰ë°ì´í„°ëŠ” UI ìš”ì†Œë¥¼ ë‹¤ë¥´ê²Œ í•´ì•¼í•˜ê¸°ë•Œë¬¸ì— ë”°ë¡œ isLast propsë¥¼ ë„£ì–´ì¤ë‹ˆë‹¤. */}
                return (
                  <MomentCard
                    revalidateMoments={revalidateMoments}
                    isLast={true}
                    key={i}
                    moment={v}
                  />
                );
              }
              return <MomentCard revalidateMoments={revalidateMoments} key={i} moment={v} />;
            })
          
            ...

          {/* refë¥¼ ë§ˆì§€ë§‰ ë¶€ë¶„ì— ë‹´ì•„ì¤ë‹ˆë‹¤ observerì— ì´ divê°€ ë³´ì´ë©´ ë°ì´í„°ë¥¼ ë” ë¶ˆëŸ¬ì˜µë‹ˆë‹¤. */}
          <div ref={ref} />
        </div>
      </MomentListWrapper>
    );
  };

  // propsê°€ ë³€í•˜ì§€ ì•ŠëŠ” í•œ ë¦¬ë Œë”ë§ì„ ë§‰ê¸° ìœ„í•´ React memoë¥¼ ë„£ì–´ì¤ë‹ˆë‹¤.
  export default memo(MomentList);

  ğŸ“moments.service.ts

  async getPosts(code?: string, page?: number, type?: string) {

    // typeORMì˜ ì¿¼ë¦¬ë¹Œë”ë¥¼ ì‚¬ìš©í•´ ê°’ì„ 10ê°œì”© ê°€ì ¸ì˜µë‹ˆë‹¤.
    // í•„ìš”ì—†ëŠ” ë°ì´í„°ë¥¼ ê°€ì§€ê³ ì˜¤ì§€ì•Šë„ë¡ leftJoin í›„ addSelect í•´ì£¼ì—ˆìŠµë‹ˆë‹¤.

    const posts = await this.MomentsRepository.createQueryBuilder('moments')
      .where(code ? \`moments.code = :code\` : '1=1', { code })
      .andWhere(type ? \`moments.type = :type\` : '1=1', { type })
      .addSelect([
        'country.name',
        'user.id',
        'user.icon',
        'user.name',
        'likedUser.id',
        'comments.id',
      ])
      .leftJoin('moments.country', 'country')
      .leftJoin('moments.user', 'user')
      .leftJoin('moments.likedUser', 'likedUser')
      .leftJoin('moments.comments', 'comments')
      .leftJoinAndSelect('moments.images', 'images')
      .orderBy('moments.id', 'DESC')
      .skip((page - 1) * 10)
      .take(10)
      .getMany();

    if (!posts) {
      throw new NotFoundException('ëª¨ë©˜íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
    }
    return posts;
  }
  
  ```

<br/>

### 8. Authì— ëŒ€í•œ ë§ì€ ê¸°ëŠ¥ë“±ì„ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.
- íšŒì›ê°€ì… / nodemailerë¥¼ ì´ìš©í•œ ì´ë©”ì¼ ì¸ì¦ / PassportJSì™€ ì„¸ì…˜,ì¿ í‚¤ë¥¼ ì´ìš©í•œ ì†Œì…œ ë¡œê·¸ì¸ ë° ë¡œê·¸ì¸ ìœ ì§€ / bcryptë¥¼ ì‚¬ìš©í•œ ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™” / íšŒì›ì •ë³´ë³€ê²½ / íšŒì›íƒˆí‡´ ë“±ì„ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.!

<br/>

<div align=center>

![fallinasia_signup](https://user-images.githubusercontent.com/74864925/130349569-9fe8143b-2e5a-4f65-863f-9528672f1ea1.png)
  
  </div>

```javascript

ğŸ“SignupModal/index.tsx & ğŸ“LoginModal/index.tsx

  const onClickSendEmailAuth = useCallback(
    (e) => {
      e.preventDefault();
      if (!email || !email?.trim()) {
        toastErrorMessage("ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
      }

      // ì •ê·œì‹ì„ ì‚¬ìš©í•´ ì´ë©”ì¼ì˜ í˜•ì‹ë„ ê¼¼ê¼¼íˆ ë”°ì ¸ì¤ë‹ˆë‹¤.

      if (!email.match(/[A-Za-z0-9_\.\-]+@[A-Za-z0-9\-]+\.[A-Za-z0-9\-]+/)) {
        toastErrorMessage("ì´ë©”ì¼ì„ í˜•ì‹ì„ ì˜¬ë°”ë¥´ê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”.");
        return;
      }
      axios
        .post("/auth/email", { email })
        .then(() => {
          setOnEmailCheckForm(true);
          toastSuccessMessage(\`\${email}ë¡œ ì´ë©”ì¼ì´ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤. ì¸ì¦ë²ˆí˜¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.\`);
        })
        .catch((error) => {
          toastErrorMessage(error);
          throw error;
        });
    },
    [email]
  );

  ...

  //íšŒì›ê°€ì…ì‹œ ì‚¬ìš©ì ì…ë ¥ê°’ì„ ì˜ˆì™¸ì²˜ë¦¬ë¡œ ê¼¼ê¼¼í•˜ê²Œ ë”°ì ¸ì¤ë‹ˆë‹¤.
  
  const onFinishSignUp = useCallback((values: any) => {
    if (!values.email || !values.email?.trim()) {
      toastErrorMessage("ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
      return;
    }
    if (!values.authNum || !values.authNum?.trim()) {
      toastErrorMessage("ì´ë©”ì¼ ì¸ì¦ë²ˆí˜¸ê°€ í•„ìš”í•©ë‹ˆë‹¤.");
      return;
    }
    if (!values.password || !values.password?.trim()) {
      toastErrorMessage("ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
      return;
    }
    let name = values?.first_name + values?.last_name;
    if (!name || !name?.trim()) {
      toastErrorMessage("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
      return;
    }
    let form: IUserRequestForm = {
      email: values.email,
      name,
      password: values.password,
      authNum: values.authNum,
    };
    dispatch(signupAction(form));
  }, []);

  ...

  // ì†Œì…œ ë¡œê·¸ì¸ êµ¬í˜„

  <a
    href={
      process.env.NODE_ENV === "development"
        ? "http://localhost:3060/api"
        : process.env.NEXT_PUBLIC_BASE_URL + "/auth/google"
    }
  >
    <img src="https://img.icons8.com/color/144/000000/google-logo.png" />
  </a>


  // ì´ë©”ì¼ ì¸ì¦

  ğŸ“auth.controller.ts
  
  @UseGuards(new NotLoggedInGuard())
  @ApiOperation({ summary: 'send auth number for signup' })
  @Post(\`email\`)
  async sendEmailAuthNumber(@Body() data) {
    const authNum = await this.AuthService.checkPossibleEmail(data.email);
    this.MailerService.sendMail({
      to: data.email,
      from: process.env.EMAIL_ID,
      subject: 'Fall IN Asia ì´ë©”ì¼ ì¸ì¦ ìš”ì²­ ë©”ì¼ì…ë‹ˆë‹¤.',
      html: \`<p>ì•ˆë…•í•˜ì„¸ìš”. Fall IN Asia ì…ë‹ˆë‹¤. ì¸ì¦ë²ˆí˜¸ë¥¼ ë³´ë‚´ë“œë¦½ë‹ˆë‹¤. ì¸ì¦ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ê³  íšŒì›ê°€ì…ì„ ì§„í–‰í•´ì£¼ì„¸ìš”</p><br/><p>ì¸ì¦ë²ˆí˜¸ : <b>\${authNum}</b></p>\`,
    });
    return true;
  }

  ğŸ“auth.service.ts

  // ë¡œê·¸ì¸ ê¸°ëŠ¥

  ...

  async validateUser(email: string, password: string) {
    const user = await this.UserRepository.findOne({
      where: { email },
      select: ['id', 'icon', 'email', 'password'],
    });
    if (!user) {
      throw new UnauthorizedException('ìœ íš¨í•˜ì§€ ì•Šì€ ì´ë©”ì¼ì…ë‹ˆë‹¤.');
    }
    const result = await bcrypt.compare(password, user.password);
    if (result) {
      const { password, ...userWithoutPassword } = user;
      return userWithoutPassword;
    } else {
      throw new UnauthorizedException('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.');
    }
  }

  ...

  ğŸ“local.strategy.ts

  // passport local strategy (ì´ì™¸ êµ¬ê¸€,ì¹´ì¹´ì˜¤,ë„¤ì´ë²„ strategyë„ êµ¬í˜„ )

  @Injectable()
  export class LocalStrategy extends PassportStrategy(Strategy) {
    constructor(private authService: AuthService) {
      super({ usernameField: 'email', passwordField: 'password' });
    }

    async validate(email: string, password: string, done: CallableFunction) {
      const user = await this.authService.validateUser(email, password);
      if (!user) {
        throw new UnauthorizedException(
          'ì´ë©”ì¼ì£¼ì†Œê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¤ì‹œí•œë²ˆ í™•ì¸í•´ì£¼ì„¸ìš”.',
        );
      }
      return done(null, user);
    }
  }
  
 ```

<br/>


### 9. SEO ìµœì í™”ë¥¼ ìœ„í•´ ë…¸ë ¥í–ˆìŠµë‹ˆë‹¤.
- ë©”íƒ€íƒœê·¸ë¥¼ ì„¸ì‹¬í•˜ê³  íš¨ìœ¨ì ì´ê²Œ ì‘ì„±í•˜ë©° (title , description ...) ì‹œë§¨í‹±ë§ˆí¬ì—… ì¤€ìˆ˜ì™€ í—¤ë”íƒœê·¸ë¥¼ ì ì ˆíˆ ì‚¬ìš©í•´ ìµœì í™”í–ˆìŠµë‹ˆë‹¤.

<br/>

```javascript

  ğŸ“pages/country/[code]/[id]

  ...

  // ë¬¸ë“ë³´ë©´ Nextì˜ Headíƒœê·¸ê°€ ë²ˆê±°ë¡œì›Œ ë³´ì´ì§€ë§Œ SEOì— ìˆì–´ì„œ ë©”íƒ€íƒœê·¸ëŠ” ì¤‘ìš”í•˜ê¸° ë•Œë¬¸ì— ìµœëŒ€í•œ ê¹Šê³  ì„¸ì„¸í•˜ê²Œ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.

  <Head>
    <title>
      {html2textConverter(moment?.content).slice(0, 20)}... - {moment?.country?.name}/
      {moment?.id}ë²ˆëª¨ë©˜íŠ¸ | Fall IN Asia
    </title>
    <meta name="description" content={html2textConverter(moment?.content).slice(0, 100)} />
    <meta
      property="og:title"
      content={\`\${html2textConverter(moment?.content).slice(0, 20)}... - \${
        moment?.country?.name
      }/
      \${moment?.id}ë²ˆëª¨ë©˜íŠ¸ | Fall IN Asia\`}
    />
    <meta
      property="og:description"
      content={html2textConverter(moment?.content).slice(0, 100)}
    />
    <meta
      property="og:image"
      content={moment?.images.length! > 0 ? moment?.images[0].image_src : WORLD_IMAGE}
    />
    <meta
      property="og:url"
      content={\`https://fallinasia.com/country/\${moment?.code}/\${moment?.id}\`}
    />
  </Head>

  ...
  
```

<br/>

### 10. í•„ìš”ì—ë”°ë¼ ëª¨ë“ˆì„ ì§ì ‘ êµ¬í˜„í•˜ì—¬ í”„ë¡œì íŠ¸ì— ìì²´ì ìœ¼ë¡œ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.
- Dayjsë¥¼ ì´ìš©í•œ ë‚ ì§œê³„ì‚° formatter , KMBT formatter (17.3K , 2M ê°™ì€ í˜•ì‹), Html to Text Converter ë“±ì„ ì§ì ‘ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

<br/>

```javascript

ğŸ“utils/dateCalculator.ts

  import dayjs from "dayjs";
  import relativeTime from "dayjs/plugin/relativeTime";
  import "dayjs/locale/ko";

  dayjs.locale("ko");
  dayjs.extend(relativeTime);

  export default function dateCalculator(createdAt: Date) {
    const createdDay = dayjs(createdAt).format("YYYY-MM-DD");
    const today = dayjs(new Date()).format("YYYY-MM-DD");
    const dayDiff = dayjs(today).diff(createdDay, "day");
    if (dayDiff > 0) {
      return createdDay;
    } else {
      return dayjs(createdAt).fromNow();
    }
  }


  ğŸ“utils/kmbtFormatter.ts

  const number_formatter = (unit: string, abs_views: number) => {
    let measure_unit = 0;
    switch (unit) {
      
      // ê±°ë“­ì œê³±ì„ ì‚¬ìš©í•œ ì´ìœ ëŠ” ê°€ë…ì„±ì„ ìœ„í•´ì„œ ì…ë‹ˆë‹¤ 100000000 ì´ë ‡ê²Œ ì“°ë©´ ëˆˆì•„í”„ê³  ìœ ì§€ë³´ìˆ˜ê°€ í˜ë“¤ì–´ì§‘ë‹ˆë‹¤.

      case "k":
        measure_unit = 10 ** 3;
        break;
      case "m":
        measure_unit = 10 ** 6;
        break;
      case "b":
        measure_unit = 10 ** 9;
        break;
      case "t":
        measure_unit = 10 ** 12;
        break;
      default:
        return;
    }
    const views_split = String(abs_views / measure_unit).split(".");
    if (views_split.length === 1) {
      return views_split[0] + unit;
    } else {
      const decimal = views_split[1].slice(0, 1);
      if (decimal === "0") {
        return views_split[0] + unit;
      } else {
        return views_split[0] + "." + decimal + unit;
      }
    }
  };


  export function kmtb_Formatter(views: number) {
    if (!views) {
      return 0;
    }
    let abs_views = Math.abs(views);
    if (abs_views < 999) {
      return abs_views;
    }
    if (999 <= abs_views && abs_views <= parseInt("9".repeat(6))) {
      return number_formatter("k", abs_views);
    }

    // repeatë¥¼ ì‚¬ìš©í•œ ì´ìœ ëŠ” ê°€ë…ì„±ì„ ìœ„í•´ì„œ ì…ë‹ˆë‹¤ 999999999 ì´ë ‡ê²Œ ì“°ë©´ ëˆˆì•„í”„ê³  ìœ ì§€ë³´ìˆ˜ê°€ í˜ë“¤ì–´ì§‘ë‹ˆë‹¤.

    if (parseInt("9".repeat(6)) < abs_views && abs_views <= parseInt("9".repeat(9))) {
      return number_formatter("m", abs_views);
    }
    if (parseInt("9".repeat(9)) < abs_views && abs_views <= parseInt("9".repeat(12))) {
      return number_formatter("b", abs_views);
    }
    if (parseInt("9".repeat(12)) < abs_views) {
      return number_formatter("t", abs_views);
    }
  }
  

  ğŸ“utils/html2textConverter.ts

  export default function html2textConverter(content?: string): string {
    return content?.replace(/(<([^>]+)>)/gi, "").replace(/&nbsp;|&amp;/gi, "") || "";
  }

```

<br/>

### 11. ìì£¼ì‚¬ìš©í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ëŠ” ë”°ë¡œ ë¶„ë¦¬í•˜ì—¬ ì¬ì‚¬ìš©ì„±ì„ í–¥ìƒì‹œì¼°ìŠµë‹ˆë‹¤.
- component / layout / section / pages ë“±ìœ¼ë¡œ ì²´ê³„ì ì´ê²Œ ë¶„ë¦¬í•´ ê°œë°œí–ˆìŠµë‹ˆë‹¤. ì˜ˆì‹œë¡œ ë„¤, ì•„ë‹ˆì˜¤ë¡œ êµ¬ì„±ëœ confirm ë©”ì„¸ì§€ê°™ì€ ê²½ìš°ì—ëŠ” ë§ì€ê³³ì—ì„œ ì‚¬ìš©ë˜ê¸° ë•Œë¬¸ì— ê°œë³„ì ì¸ ì»´í¬ë„ŒíŠ¸ë¡œ ë¶„ë¦¬í•´, ì•Œë§ëŠ” propsë¥¼ ê·¸ë•Œê·¸ë•Œ ë„£ì–´ì£¼ëŠ” ë°©ì‹ìœ¼ë¡œ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.

<br/>

```javascript

ğŸ“ConfirmToastify.tsx

  import { toast } from "react-toastify";

  const ConfirmToastForm = ({
    onClickConfirm,
    closeToast,
    message,
    type,
  }: {
    onClickConfirm: () => void;
    closeToast?: any;
    message: string;
    type: string;
  }) => (
    <div style={{ cursor: "default" }}>
      <h4 style={{ marginLeft: "0.3rem" }}>{message}</h4>
      <div className="confirm-btn-wrapper">
        <button
          onClick={() => {
            onClickConfirm();
            closeToast();
          }}
        >
          ë„¤ {type}
        </button>
        <button onClick={closeToast}>ì•„ë‹ˆìš”</button>
      </div>
    </div>
  );
  
  export const toastConfirmMessage = (onClickConfirm: () => void, message: string, type: string) => {
    toast(<ConfirmToastForm onClickConfirm={onClickConfirm} message={message} type={type} />, {
      position: "top-center",
      hideProgressBar: true,
      closeOnClick: false,
      pauseOnHover: true,
      draggable: true,
      progress: undefined,
    });
  };
  
 ```

<br/>

### 12. ì½”ë“œì˜ ê°€ë…ì„±ì„ ìµœëŒ€í•œ ê³ ë ¤í•˜ë©° ì¤‘ë³µë°©ì§€ë¥¼ ìœ„í•´ í˜ì¼ìŠµë‹ˆë‹¤.
- ë³´ì—¬ë“œë¦¬ëŠ” ì½”ë“œëŠ” ì¤‘ë³µ ìµœì†Œí™” ì‘ì—…ì„ ì§„í–‰í•œ ì½”ë“œì˜ ì˜ˆì‹œì…ë‹ˆë‹¤. ì¤‘ë³µì œê±°ë„ ì¢‹ì§€ë§Œ ê·¸ê²ƒì´ ê°€ë…ì„±ì´ ë–¨ì–´ì§€ëŠ” ìš”ì¸ì´ ëœë‹¤ë©´ ì¤‘ë³µ ìµœì†Œí™” ì‘ì—…ì„ ì¼ë‹¨ ê³ ë ¤í•˜ê±°ë‚˜ ë³´ë¥˜í•©ë‹ˆë‹¤.

<br/>

```javascript

ğŸ“UserInfoAside/index.tsx

  // í•¨ìˆ˜ë“¤ì´ "í´ë¦­í•˜ë©´ ìœ ì €ì˜ ì •ë³´ë¥¼ ë³€ê²½í•œë‹¤ ë‹¤ë§Œ ë³¸ì¸ì´ ì•„ë‹ˆë©´ ë°˜ë ¤í•œë‹¤" ëŠ” ë§¥ë½ì´ ê°™ìŠµë‹ˆë‹¤.
  // ê°€ë…ì„±ì„ ìœ ì§€í•˜ë©° ì¤‘ë³µì„ ìµœì†Œí™”í•˜ê¸° ìœ„í•´ ì½”ë“œë¥¼ ë³€ê²½í•˜ê² ìŠµë‹ˆë‹¤.
  
  const onClickConfirmRemoveIcon = useCallback(() => {
    if (!isOwner) {
      toastErrorMessage("ë³¸ì¸í”„ë¡œí•„ë§Œ ë³€ê²½ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
      return;
    }
    dispatch(deleteUserIconAction());
  }, [isOwner]);

  const onClickChangeUserInfo = useCallback(() => {
    if (!isOwner) {
      toastErrorMessage("ë³¸ì¸í”„ë¡œí•„ë§Œ ë³€ê²½ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
      return;
    }
    dispatch(changeUserInfoAction({ userName, introduce }));
    setUserInfoEdit(false);
  }, [userName, introduce, isOwner]);

  const onClickChangePassword = useCallback(() => {
    if (!isOwner) {
      toastErrorMessage("ë³¸ì¸í”„ë¡œí•„ë§Œ ë³€ê²½ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
      return;
    }
    dispatch(changeUserPasswordAction({ prevPassword, newPassword }));
  }, [prevPassword, newPassword, isOwner]);

  const onClickWithdrawal = useCallback(() => {
    if (!isOwner) {
      toastErrorMessage("ë³¸ì¸í”„ë¡œí•„ë§Œ ë³€ê²½ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
      return;
    }
    dispatch(mainSlice.actions.toggleWithdrawalModal());
  }, [isOwner]);




  //
  // ğŸ‘Š ì¤‘ë³µìµœì†Œí™”ë¥¼ ìœ„í•´ ì½”ë“œë¥¼ ì´ë ‡ê²Œ ë³€ê²½í–ˆìŠµë‹ˆë‹¤.
  //

  const onClickUserSetting = useCallback(
    (type: string) => {
      if (!isOwner) {
        toastErrorMessage("ë³¸ì¸í”„ë¡œí•„ë§Œ ë³€ê²½ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
        return;
      }
      switch (type) {
        case "remove_icon":
          dispatch(deleteUserIconAction());
          break;
        case "user_info":
          dispatch(changeUserInfoAction({ userName, introduce }));
          setUserInfoEdit(false);
          break;
        case "password":
          dispatch(changeUserPasswordAction({ prevPassword, newPassword }));
          break;
        case "withdrawal":
          dispatch(mainSlice.actions.toggleWithdrawalModal());
          break;
        default:
          return;
      }
    },
    [isOwner, userName, introduce, prevPassword, newPassword]
  );
 
 ```

<br/>

### 13. CSS stylingì„ ì²´ê³„ì ìœ¼ë¡œ ì‘ì„±í•˜ê³  custom CSSë¥¼ ì‚¬ìš©í•´ ê°€ëŠ¥í•œ í•œ ì¤‘ë³µì„ ì¤„ì´ê³  ëŠ¥ë¥ ì„ ë†’ì˜€ìŠµë‹ˆë‹¤.
- ê°œë³„ì ìœ¼ë¡œ styles.tsx íŒŒì¼ì„ ë‘ë©° tailwindCSS ì™€ emotionì„ ì ìš©í–ˆìŠµë‹ˆë‹¤. ellipsisì²˜ë¦¬ì™€ flex ìŠ¤íƒ€ì¼ë“±ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œë„ ë°˜ë³µëœ ì‘ì—…ì´ ë§ì•„ custom CSSë¡œ ë§Œë“¤ì–´ í•´ê²°í–ˆìŠµë‹ˆë‹¤.

<br/>

```javascript

ğŸ“Header/styles.tsx

  export const HeaderWrapper = (headerDownSize: boolean) => css\`

    \${tw\`w-full bg-white fixed\`}
    \${headerDownSize ? tw\`py-2 px-4\` : tw\`py-4 px-8\`}
    z-index:60;
    transition: 0.3s all;
    \${BORDER_THIN("border-bottom")};
    \${FLEX_STYLE("space-between", "center")};

    .header-logo {
      \${tw\`w-40 h-8 mr-6\`}
      transition: 0.3s all;
      \${headerDownSize && \`transform:scale(0.8);\`}
      img {
        \${tw\`w-full h-full\`}
      }
    }
    .header-list {
      transition: 0.3s all;
      \${tw\`ml-3 relative\`}
      padding: 0.3rem 0.5rem;
      &-anchor {
        transition: 0.3s all;
        \${tw\`font-bold\`}
        \${headerDownSize ? tw\`text-sm\` : "font-size:1.05rem"}
      }
    }

    .notice-icon,
    .search-icon,
    .menu-icon {
      \${headerDownSize ? tw\`text-base\` : tw\`text-2xl\`}
    }
    .user-icon {
      \${tw\`w-10 h-10 rounded-full\`}
      transition: 0.3s all;
      \${headerDownSize && tw\`w-8 h-8\`}
    }

    @media (max-width: \${MD_SIZE}) {
      \${tw\`px-4\`}
    }
  \`;

  ğŸ“config.ts

  export const FLEX_STYLE = (justify: string, align: string, flexStyle?: string) => \`
    display:flex;
    justify-content:\${justify};
    align-items:\${align};
    flex-direction:\${flexStyle};
  \`;

  export const ELLIPSIS_STYLE = (lineHeight: number, clamp: number, height: string) => \`
    line-height: \${lineHeight};
    -webkit-line-clamp: \${clamp};
    height: \${height};
    display: -webkit-box;
    -webkit-box-orient: vertical;
    overflow: hidden;
    word-wrap: break-word;
    text-overflow: ellipsis;
  \`;

  export const GRID_STYLE = (gap: string, colums: string, row?: string) => \`
    display:grid;
    grid-template-columns:\${colums};
    grid-template-rows:\${row};
    gap:\${gap};
  \`;

  ...

```

<br/>

### 14. ë°ì´í„°ë² ì´ìŠ¤ ER ë‹¤ì´ì–´ê·¸ë¨
- ëª¨ë“  ì¤‘ì‹¬ì€ User Tableë¡œ ëŒì•„ê°€ë©° í•˜ìœ„ì—”í‹°í‹°ì—ëŠ” Cascadeë¥¼ ì ìš©í•©ë‹ˆë‹¤. Commentì™€ NoticeëŠ” ì—­ì •ê·œí™”ë¡œ í•˜ë‚˜ì˜ í…Œì´ë¸”ì„ ì´ìš©í•˜ê³ ìˆìŠµë‹ˆë‹¤. 1:1, 1:N, N:M ê´€ê³„ë¥¼ ì´í•´í•©ë‹ˆë‹¤.

<br/>

![fallinasia_erd](https://user-images.githubusercontent.com/74864925/130349640-2e721aec-def3-498c-8003-44fb1ded6b19.jpg)

<br/>

### 15. NestJSì˜ ë¼ì´í”„ì‚¬ì´í´ì„ ì´í•´í•˜ë©° ì ê·¹ì ìœ¼ë¡œ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.
- Middleware (ex/ session,multer ...) , Guard , Intersepter , Decorators ë“±ì„ ì´í•´í•©ë‹ˆë‹¤.

<br/>

```javascript

ğŸ“moments.controller.ts

  // UserGuardsë¥¼ ì‚¬ìš©í•´ì„œ ë¡œê·¸ì¸ëœ ì‚¬ìš©ìì¸ì§€ í™•ì¸í•©ë‹ˆë‹¤.
  @UseGuards(new LoggedInGuard())
  @ApiOperation({ summary: 'Create moment post' })
  @UseInterceptors(
    // UserInterceptorì˜ multerë¥¼ ì´ìš©í•´ ì´ë¯¸ì§€íŒŒì¼ì„ ì €ì¥í•©ë‹ˆë‹¤.
    FilesInterceptor('image', 5, {
      storage: multerS3({
        s3: new AWS.S3(),
        bucket: process.env.S3_BUCKET_NAME,
        key(req, file, cb) {
          cb(
            null,
            \`original/\${Date.now()}_\${path.basename(file.originalname)}\`,
          );
        },
      }),
      limits: { fileSize: 20 * 1024 * 1024 },
    }),
  )
  @Post()
  async createPost(
    // DTOë„ ì²´ê³„ì ì´ê²Œ ì‘ì„±í•´ì¤ë‹ˆë‹¤.
    @Body() form: MomentCreateRequestDto,
    // Decoratorë¥¼ ì´ìš©í•´ ë°”ë¡œ passportJSì—ì„œ userë¥¼ ë½‘ì•„ì¤ë‹ˆë‹¤.
    // Decoratorê°€ ì—†ìœ¼ë©´ @Req() ì—ì„œ req.userë¡œ ë‘ë²ˆ ë½‘ì•„ì•¼í•˜ëŠ” ë²ˆê±°ë¡œì›€ì´ ìˆìŠµë‹ˆë‹¤.
    @User() user,
    @UploadedFiles() files: Express.MulterS3.File[],
  ) {
    return await this.MomentsService.createPost(form, user.id, files);
  }

  
  ğŸ“user.decorator.ts

  export const User = createParamDecorator(
    (data: unknown, ctx: ExecutionContext) => {
      // contextì—ì„œ httpì˜ reqë¥¼ ë¶ˆëŸ¬ì˜¤ê³  passportJSë¥¼ í†µí•´ userë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤. 
      // userëŠ” ìì£¼ ë¶ˆëŸ¬ì˜¤ê¸°ë•Œë¬¸ì— decoratorë¡œ ë§Œë“¤ì–´ì£¼ì—ˆìŠµë‹ˆë‹¤.
      const request = ctx.switchToHttp().getRequest();
      return request.user;
    },
  );


  ğŸ“logged-in.guard.ts

  @Injectable()
  export class LoggedInGuard implements CanActivate {
    canActivate(
      context: ExecutionContext,
    ): boolean | Promise<boolean> | Observable<boolean> {
      // contextì—ì„œ httpì˜ reqë¥¼ ë¶ˆëŸ¬ì˜¤ê³  passportJSë¥¼ í†µí•´ isAuthenticated ê°€ì ¸ì˜µë‹ˆë‹¤. 
      // isAuthenticatedëŠ” booleanê°’ì´ë©° ì´ guardë¥¼ ê±°ì³ê°€ë©´ ì¸ì¦ëœ ìœ ì €ë§Œ êµ¬ë³„í•´ controllerë¥¼ ì‹¤í–‰ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      const request = context.switchToHttp().getRequest();
      return request.isAuthenticated();
    }
  }
  
```

<br/>

### 16. Mysqlì˜ ngram Full-textê²€ìƒ‰ê³¼ ì¸ë±ì‹±ì„ ì´ìš©í•´ DB ê²€ìƒ‰ ì„±ëŠ¥ì„ í–¥ìƒì‹œì¼°ìŠµë‹ˆë‹¤.
- ì´ì „ í”„ë¡œì íŠ¸(Noahworld)ì—ì„œ Like '%í‚¤ì›Œë“œ%'ì˜ í’€ìŠ¤ìº”ì„ ì‚¬ìš©í–ˆì„ë•Œë³´ë‹¤ 5~10ë°°ì •ë„ ì†ë„ë¥¼ í–¥ìƒì‹œì¼°ìŠµë‹ˆë‹¤.

<br/>

```javascript

ğŸ“Moments.ts

  // ì¸ë±ì‹±ê³¼ fulltext ëª¨ë“œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. parserëŠ” ë„ì–´ì“°ê¸°ê°€ ì§€ë°°ì ì´ì§€ ì•Šì€ ë¬¸ìì¸ í•œì¤‘ì¼ì–´ì—ì„œ ìì£¼ ì‚¬ìš©í•˜ëŠ” n-gramìœ¼ë¡œ ì±„íƒí–ˆìŠµë‹ˆë‹¤.
  // ë¹„ë‹¨ fulltext ê²€ìƒ‰ë¿ë§Œì´ ì•„ë‹ˆë¼ ë‹¤ì–‘í•œ ì—”í‹°í‹°ì— ì¸ë±ì‹±ì„ ì§€ì •í•´ì£¼ì—ˆìŠµë‹ˆë‹¤.

  @Index(['content'], { fulltext: true, parser: 'ngram' })
  @IsString()
  @IsNotEmpty()
  @ApiProperty({
    example: 'ì œê°€ ë¬¼ì–´ë³¼ê²ŒìˆìŠµë‹ˆë‹¤! ì €ëŠ” íƒœêµ­ì„ ì—¬í–‰í•˜ëŠ”..',
    description: 'content in the main post',
  })
  @Column('longtext', { name: 'content' })
  content: string;

...

  ğŸ“app.service.ts

  async getSearchPosts(searchWord: string) {
    const moments = await this.MomentsRepository.createQueryBuilder('moments')
      .leftJoinAndSelect('moments.country', 'country')
      .leftJoinAndSelect('moments.user', 'user')
      .where(\`MATCH(content) AGAINST ('\${searchWord}' IN BOOLEAN MODE)\`)
      .getMany();

    const stories = await this.StoriesRepository.createQueryBuilder('stories')
      .select(['stories.title', 'stories.thumbnail', 'stories.id'])
      .leftJoinAndSelect('stories.country', 'country')
      .leftJoinAndSelect('stories.comments', 'comments')
      .leftJoinAndSelect('stories.likedUser', 'likedUser')
      .leftJoinAndSelect('stories.user', 'user')
      .where(\`MATCH(stories.content) AGAINST ('\${searchWord}' IN BOOLEAN MODE)\`)
      .orWhere(
        \`MATCH(stories.region) AGAINST ('\${searchWord}' IN BOOLEAN MODE)\`,
      )
      .orWhere(\`MATCH(stories.title) AGAINST ('\${searchWord}' IN BOOLEAN MODE)\`)
      .getMany();

    return { searchWord, moments, stories };
  }

```

<br/>

### 17. ì‹¤ì‹œê°„ ì¸ê¸° ê²Œì‹œê¸€ ê¸°ëŠ¥ì„ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.
- ìì²´ì ìœ¼ë¡œ ì ìˆ˜ë¥¼ ë§¤ê²¨ ë½‘ì•„ë‚¸ ì¸ê¸° ê²Œì‹œê¸€ 4ê°œë¥¼ í”„ë¡ íŠ¸ë¡œ ì „ë‹¬í•©ë‹ˆë‹¤.

<br/>

```javascript

ğŸ“stories.service.ts

  async getPopularPosts(code?: string) {
    const pointWithpostId = await this.StoriesRepository.createQueryBuilder(
      'stories',
    )
      .select([
        'stories.id',
        'stories.hit',
        'likedUser.id as user_len',
        'comments.id as comment_len',
      ])
      .leftJoinAndSelect('stories.likedUser', 'likedUser')
      .leftJoinAndSelect('stories.comments', 'comments')
      .where(code ? \`stories.code = :code\` : '1=1', { code })
      .orderBy('stories.id', 'DESC')
      .take(50)
      .getMany()
      .then((res) => {
        return res
          .map((v) => {
            // ìµœì‹  50ê°œì˜ ê²Œì‹œê¸€ì„ ê°€ì ¸ì˜¤ê³  ê·¸ì¤‘ì—ì„œ ì ìˆ˜ë¥¼ ë§¤ê²¨ì„œ ìƒìœ„ 4ê°œë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
            return {
              // ì¡°íšŒìˆ˜ 1íšŒë‹¹ ì €ëŠ” 0.001ì ì„ ë¶€ì—¬í•˜ì˜€ê³ ,
              // ëŒ“ê¸€ì˜ ê²½ìš° 1ì ì„ ë¶€ì—¬í•˜ì˜€ìŠµë‹ˆë‹¤.
              // ê·¸ë¦¬ê³  ì¶”ì²œì˜ ê²½ìš° ê°€ì¥ ë†’ì€ ë°°ì ì¸ 5ì ì„ ì„¤ì •í•˜ì˜€ìŠµë‹ˆë‹¤.
              id: v.id,
              point: v.hit * 0.001 + v.comments.length + v.likedUser.length * 5,
            };
          })
          .sort((a: any, b: any) => b.point - a.point)
          .splice(0, 4);
      });
    let popularPosts = [];
    for (const i of pointWithpostId) {
      //ìƒìœ„ 4ê°œì˜ ì¸ê¸°í¬ìŠ¤íŠ¸ë¥¼ ê°ê° ë°°ì—´ì— ë‹´ì•„ ë°˜í™˜í•©ë‹ˆë‹¤.
      await this.StoriesRepository.findOne({
        where: { id: i.id },
        relations: ['user', 'country', 'likedUser', 'comments'],
      }).then((res) => {
        popularPosts.push(res);
      });
    }

    return popularPosts;
 
 ```

<br/>

### 18. ì¡°íšŒìˆ˜ ì¤‘ë³µë°©ì§€ ê¸°ëŠ¥ì„ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.
- í˜„ì¬ëŠ” ì‚¬ì´íŠ¸ê°€ ì¡°íšŒìˆ˜ ì–´ë·°ì§•ì„ í• ë§Œí•œ ê·œëª¨ì˜ ì‚¬ì´íŠ¸ë„ ì•„ë‹ˆë©° ë˜ë ¤ ì˜¤ë²„ì—”ì§€ë‹ˆì–´ë§ì˜ ëŠë‚Œì„ ë°›ì•„ ì‚­ì œí–ˆìŠµë‹ˆë‹¤. ì´ëŸ° ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ê³  ê³µë¶€ë¥¼ í–ˆë‹¤ëŠ” ì‚¬ì‹¤ì— ë§Œì¡±í•©ë‹ˆë‹¤.

<br/>

```javascript

// ìƒˆë¡œìš´ ì˜¤ë¸Œì íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
  // ì„œë²„ë¥¼ ì¬ì‹œì‘í•˜ë©´ ì˜¤ë¸Œì íŠ¸ë„ ì´ˆê¸°í™”ëœë‹¤ëŠ” ë‹¨ì ì´ ìˆìŠµë‹ˆë‹¤.
  const viewObj = new Object();

  ...

  async getOnePost(storyId: number, code: string, ip: string) {
    const post = await this.StoriesRepository.findOne({
      where: {
        id: storyId,
        code,
      },
      relations: [
        'user',
        'country',
        'likedUser',
        'images',
        'comments',
        'comments.user',
        'comments.likedUser',
        'comments.subComments',
        'comments.subComments.user',
      ],
    });
    if (!post) {
      throw new NotFoundException('ê°€ì ¸ì˜¬ ê²Œì‹œë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.');
    }
    // client ipëŠ” X-Forwarded-For ì„¤ì •ì„ í†µí•´ req header ì—ì„œ ê°€ì ¸ì˜µë‹ˆë‹¤
    // ì´ í”„ë¡œì íŠ¸ëŠ” reverse proxy ë¥¼ ì“°ê¸°ë•Œë¬¸ì— nginx configì™€ trust proxy ì„¤ì •ë„ ì¶”ê°€í•˜ì˜€ìŠµë‹ˆë‹¤.
    if (post && ip !== 0) {
      if (!viewObj[storyId]) {
        // ê°’ì´ì—†ë‹¤ë©´ ë¹ˆë°°ì—´ì„ ë§Œë“­ë‹ˆë‹¤.
        viewObj[storyId] = [];
      }
      if (viewObj[storyId].indexOf(ip) === -1) {
        // í•´ë‹¹ ipê°€ objì— ì—†ë‹¤ë©´ ì¶”ê°€í•˜ê³  ì¡°íšŒìˆ˜ë¥¼ ì˜¬ë¦½ë‹ˆë‹¤.
        viewObj[storyId].push(ip);
        await this.StoriesRepository.createQueryBuilder('stories')
          .update('stories')
          .update()
          .set({
            hit: () => 'hit + 1',
          })
          .where('id = :id', { id: storyId, code })
          .where('id = :id', { id: storyId })
          .execute();
        setTimeout(() => {
          viewObj[storyId].splice(viewObj[storyId].indexOf(ip), 1);
          //10ë¶„ë’¤ì— ê°’ì„ ì‚­ì œí•´ì¤ë‹ˆë‹¤. ì¦‰ 10ë¶„ë’¤ì— ë‹¤ì‹œ ê²Œì‹œê¸€ì„ ë³´ë©´ ì¡°íšŒìˆ˜ê°€ ì˜¬ë¼ê°‘ë‹ˆë‹¤.
        }, 1000*60*10);
      }
    }
    return post;
  }
  
```

<br/>

### 19. í˜‘ì—…ì„ ëŒ€ë¹„í•´ Swaggerë¥¼ ì´ìš©í•œ API docs ì™€ git Branch,Trello,Slackë“±ì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.
- ì €ëŠ” í”„ë¡ íŠ¸,ì„œë²„,ë°°í¬ë¥¼ í˜¼ìì„œ ì‘ì—…í–ˆê¸°ë•Œë¬¸ì— í˜‘ì—…ì„ ë¯¸ë¦¬ ê²½í—˜í•´ ëŒ€ë¹„í•˜ëŠ”ê²Œ ì˜³ë‹¤ê³  ìƒê°í•˜ì—¬ í˜‘ì—…íˆ´ì„ í˜¼ì ì‚¬ìš©í•´ë´¤ìŠµë‹ˆë‹¤.

<br/>

<div align=center>

![fallinasia_apidocs](https://user-images.githubusercontent.com/74864925/130349713-1a292a03-f401-4878-ac45-4c3929aedc94.png)

![fallinasia_slack](https://user-images.githubusercontent.com/74864925/130349715-780190a1-b9b4-48d4-acba-6bc5100898f2.jpg)

![fallinasia_trello](https://user-images.githubusercontent.com/74864925/130349716-a0654450-6964-4638-b693-254652dd7aa9.jpg)
  
  </div>

<br/><br/><br/>

## ğŸ¯ Self Interview

<br/>

> ğŸ¤ :Redux vs SWR , React-Query

ë¦¬ë•ìŠ¤ëŠ” ë°©ëŒ€í•œ ì½”ë“œëŸ‰(+ë°˜ë³µì‘ì—…)ì´ë‘ ì´ˆê¸°ì„¤ì •,ë¬´ê±°ì›€ì´ ë‹¨ì ì…ë‹ˆë‹¤. í•˜ì§€ë§Œ npm trandë‚˜ Devtoolì˜ ê°•ë ¥í•¨, ë§ˆì§€ë§‰ìœ¼ë¡œ ì•ˆì •ì„±ì„ ì¶”êµ¬í•˜ê³  ë³€í™”ì— ì‹ ì¤‘í•´ì•¼í•˜ëŠ” ì‹¤ë¬´ì—ì„  reduxê°€ í›¨ì”¬ ì••ë„ì ì´ë©° ì € ë˜í•œ reduxê°€ ì—¬ëŸ¬ë°©ë©´ì—ì„œ ì¢‹ë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤. ì‹¤ë¬´ì—ì„œ ì–´ë–¤ê¸°ìˆ ì„ ì“°ëŠëƒì— ë”°ë¼ê°€ê¸°ë¡œí–ˆìœ¼ë©°, ì´ í”„ë¡œì íŠ¸ì—ì„œë„ SWRì„ ì£¼ë¡œ ì‚¬ìš©í–ˆì§€ë§Œ localìª½ê³¼ userë¶€ë¶„ ìƒíƒœê´€ë¦¬ëŠ” redux-toolkitì„ ì‚¬ìš©í•´ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

<br/>

> ğŸ¤ : NestJS vs Express

Expressê°€ ììœ ë¶„ë°©í•œ "ë‚˜ëŠ” ìì—°ì¸ì´ë‹¤" ëŠë‚Œì´ë¼ë©´ NestJSëŠ” ë²•ì¹™ê³¼ ë£°ì´ìˆëŠ” "ì •ê¸€ì˜ë²•ì¹™" ëŠë‚Œì´ì˜€ìŠµë‹ˆë‹¤. NestJSë„ Expressë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë§Œë“¤ì–´ì¡Œê³  ê±°ê¸°ì— ë”í•´ ì¼ê´€ì„±ìˆëŠ” êµ¬ì¡°ì™€ Angularì™€ Springì˜ ëŒ€ëµì ì¸ íë¦„ë„ ì–´ë ´í’‹ì´ ìµíìˆ˜ìˆê¸° ë•Œë¬¸ì— NestJSë¥¼ ë” ì„ í˜¸í•©ë‹ˆë‹¤. 

<br/>

> ğŸ¤ : tailwind.CSS ì–´ë–¤ê°€ìš”?

ì•„ì£¼ ë§Œì¡±í•˜ê³  ì˜ ì‚¬ìš©í•˜ê³ ìˆìŠµë‹ˆë‹¤. í—ˆë‚˜ ì €ì˜ ì½”ë”©ì»¨ë²¤ì…˜ì´ htmlê³¼ cssëŠ” ë˜ë„ë¡ ë”°ë¡œ ë¶„ë¦¬í•˜ëŠ”ê²ƒì¸ë° jsxì˜ classì— tailwindë¥¼ ë„£ê²Œë˜ë©´ ê·¸ ì·¨ì§€ì— ì–´ê¸‹ë‚˜ê²Œë©ë‹ˆë‹¤. ê·¸ë˜ì„œ twin.macroë¥¼ ì‚¬ìš©í•´ CSS in JSì™€ ë¬¶ì–´ì„œ ë”°ë¡œ ê´€ë¦¬í–ˆìŠµë‹ˆë‹¤.

<br/>

> ğŸ¤ : Mapbox vs Google map

ì´ìš©ì´ ê°„í¸í•˜ê³  API í•œë„ ì œì•½ì´ ê±°ì˜ ì—†ëŠ” Mapboxë¥¼ ì„ í˜¸í•˜ë‚˜ ë¹Œë“œë•Œ Analyzerì—ì„œ ìš©ëŸ‰ì´ ì–´ë§ˆë¬´ì‹œ í•˜ë‹¤ëŠ”ê²ƒì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤. Tree shakingì„ í•´ë³´ë ¤ ë¬¸ì˜í•´ë´¤ì§€ë§Œ "ìš°ë¦¬ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ë§¤ìš° ê³ ê¸‰ì§€ê³  ê¸°ëŠ¥ì´ ë§ê¸°ë•Œë¬¸ì— ìš©ëŸ‰ì´ í°ê±´ ì–´ì©”ìˆ˜ì—†ë‹¤" ë¼ëŠ” ë‹µë³€ì´ ëŒì•„ì™”ìŠµë‹ˆë‹¤. ë§ëŠ”ë§ì´ë©°, ì¼ë‹¨ ìœ ì§€ë³´ìˆ˜ì‹œ ìš©ëŸ‰ë•Œë¬¸ì— ì°¨ì§ˆì´ ìƒê¸°ë©´ google mapìœ¼ë¡œ ë³€ê²½ í•  ìƒê°í™ë‹ˆë‹¤.

<br/><br/><br/>

## ğŸ¯ Feedback

<br/>

> ğŸ¤ : ê°œë°œê³¼ì • ì¤‘ í˜ë“¤ì—ˆë˜ ë¶€ë¶„ê³¼ í”¼ë“œë°±ì€?

<br/>

- ë°°í¬ í›„ ëª¨ë°”ì¼ì—ì„œ antdì™€ emotionì˜ grobal styleì´ ì„œë¡œ ì¶©ëŒì„ ì¼ìœ¼ì¼œì„œ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ë° ì• ë¥¼ ë¨¹ì—ˆìŠµë‹ˆë‹¤. cssì˜ ì ìš© ìš°ì„ ìˆœìœ„ì™€ ì¶©ëŒì— ëŒ€í•´ì„œ ì•Œê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

- í”„ë¡ íŠ¸ì—”ë“œ ì„±ëŠ¥ ìµœì í™” ì‘ì—…ì— ëŒ€í•´ì„œ ê¸°ë³¸ê¸°ê°€ ë¶€ì¡±í–ˆìŠµë‹ˆë‹¤. ê³µë¶€ í›„ ë¹„ë™ê¸° http ìš”ì²­ì— ë¬´ê±°ì›€ì„ ì¸ì§€í•´ ì“¸ë°ì—†ëŠ” ì„œë²„ ìš”ì²­ì„ ì¤„ì˜€ìœ¼ë©°, ë¦¬í”Œë¡œìš°ë¥¼ ìµœì†Œí™”, ë‹¤ì´ë‚˜ë¯¹ë¼ìš°íŒ… (íŠ¹íˆ ë§µëª¨ë“ˆê³¼ ìœ„ì§€ê¸€ì—ë””í„°), ìŠ¤í¬ë¡¤ì´ë²¤íŠ¸ì˜ throttle , ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì¦ˆ ë° ì••ì¶• ë“±ì„ ì‚¬ìš©í•´ ìµœì í™”í–ˆìŠµë‹ˆë‹¤.

- DBë¥¼ ê³„ì† ì •ê·œí™”í•´ì„œ ê²°êµ­ ë§ì€ ì¡°ì¸ ì—°ì‚°ìœ¼ë¡œ DB ì„±ëŠ¥ì´ ê°ì†Œí–ˆì—ˆìŠµë‹ˆë‹¤. Commentì™€ NoticeëŠ” ì—­ì •ê·œí™”ë¥¼ ì™„ë£Œí–ˆìœ¼ë‚˜ Moments + Stories + Articles í…Œì´ë¸” ê¹Œì§€ë„ í•˜ë‚˜ì˜ Posts í…Œì´ë¸”ë¡œ ì—­ì •ê·œí™”ë¥¼ í•´ì•¼í• ì§€ ì•„ì§ ê°ˆí”¼ë¥¼ ì¡ì§€ ëª»í•˜ê³  ìˆìŠµë‹ˆë‹¤.

- í•˜ë‚˜ì˜ GET ìš”ì²­ì— 11ë²ˆì˜ DB ì ‘ê·¼ì„ í•˜ëŠ” ì¿¼ë¦¬ (ì¸ê¸°êµ­ê°€ë¦¬ìŠ¤íŠ¸ìš”ì²­)ì™€ IPë¥¼ í†µí•œ ì¤‘ë³µì¡°íšŒìˆ˜ ë°©ì§€ê¸°ëŠ¥ì´ ì„œë²„ì„±ëŠ¥ì— ë¬´ë¦¬ë¥¼ ì¤¬ì—ˆìŠµë‹ˆë‹¤. ì½”ë“œëŠ” ì•ˆ ì“°ëŠ” ê²Œ ê°€ì¥ ì¢‹ì€ ì½”ë“œë¼ëŠ” ë§ì´ ëª¨í† ì´ê¸°ë•Œë¬¸ì— ê¼­ í•„ìš”í•œ ê¸°ëŠ¥ì¸ì§€ ì ê²€ í›„ ì œê±°í–ˆìŠµë‹ˆë‹¤.

- ì‹¤ë¬´ì—ì„  ë¶„ì—…ê³¼ í˜‘ì—…ì„ í†µí•´ì„œ ì¼í•˜ê¸° ë•Œë¬¸ì— í˜¼ìì„œ ë””ìì¸ë¶€í„° ë°°í¬ê¹Œì§€ ë‹¤í•œ ê²ƒì´ ë…ì´ ë  ìˆ˜ ìˆë‹¤ëŠ” ì ì„ ê¹¨ë‹¬ì•˜ìŠµë‹ˆë‹¤. ì €ëŠ” ëª…í™•í•˜ê²Œ í”„ë¡ íŠ¸ì—”ë“œë¥¼ ì§€ë§í•˜ë©° ìµœê·¼ì—ëŠ” íŠ¹íˆ CSSë¥¼ ì¢€ ë” ê¹Šê²Œ ê³µë¶€í•˜ê³  ìˆìŠµë‹ˆë‹¤.

- ìœ„ì™€ ê°™ì€ ì¼í™˜ìœ¼ë¡œ í˜‘ì—…ì„ í•˜ì§€ ì•Šì•„ ìê¸°ë§Œì˜ ì„¸ê³„ì— ê°‡íŒ ëŠë‚Œì´ ë“­ë‹ˆë‹¤. í˜‘ì—…íˆ´ì„ í˜¼ìì„œ ì‚¬ìš©í•´ë³´ë©° í˜‘ì—…ì— ë¯¸ë¦¬ ëŒ€ë¹„í–ˆê³  ë‹¤ë¥¸ ì‚¬ëŒì˜ í”„ë¡œì íŠ¸ë‚˜ ì˜¤í”ˆì†ŒìŠ¤ë¥¼ ë¶„ì„ í•´ë³´ë©° ì—¬ëŸ¬ ì‚¬ëŒì˜ ì½”ë“œë¥¼ ì˜ í¡ìˆ˜í•  ìˆ˜ ìˆë„ë¡ ê³µë¶€í•˜ê³  ìˆìŠµë‹ˆë‹¤. ë˜í•œ ì‹¤ë¬´ì—ì„  íšŒì‚¬ì˜ ì½”ë”©ì»¨ë²¤ì…˜ê³¼ ê¸°ìˆ  ìŠ¤íƒì„ ì˜ ë”°ë¥´ê¸°ë¡œ ë‹¤ì§í–ˆìŠµë‹ˆë‹¤.

<br/><br/><br/>

## Thank you!

<br/>

> ğŸ¤ : êµ¬ê²½ê°ˆë˜ìš”!

#### <a href="https://fallinasia.com">Fall IN Asia ë°”ë¡œê°€ê¸°</a>
#### í…ŒìŠ¤íŠ¸ ê³„ì • : test@test / 123123123

<br/>

> ğŸ¤ : ì—…ë°ì´íŠ¸ ìƒí™©ì„ ì•Œë ¤ì£¼ì„¸ìš”

<br/>

| Date | Version | Update |
| ------ | ------ | ------ |
| 2020/08/13 | v1.0 | Final Update for first deployment through AWS |
| 2020/10/13 | v1.1 | SEO Optimization |
| 2020/11/09 | v1.2 | KOR&JPN&ENG Multilingual System |

<br/>

> ğŸ¤ : ë§ˆì§€ë§‰ìœ¼ë¡œ í•˜ê³  ì‹¶ì€ë§ì€?

<br/>

í”¼ë“œë°±ì€ í•­ìƒ ì €ë¥¼ ì„±ì¥ì‹œí‚¤ê²Œ í•©ë‹ˆë‹¤.

ê¶ê¸ˆí•œê²Œ ìˆìœ¼ì‹œë©´ noah071610@gmail.com ìœ¼ë¡œ ì–¸ì œë“ ì§€ í¸í•˜ê²Œ ì—°ë½ì£¼ì„¸ìš”.


<br/><br/><br/>

